<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4Linhas - Painel Administrativo</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/pages/admin.css') }}">
  <link rel="icon" href="{{ url_for('static', path='assets/logo/4linhas-bg-red.svg') }}">
  <style>
    html {
      scroll-behavior: smooth;
    }
    section {
      margin-bottom: 20px;
      scroll-margin-top: 80px;
    }
    .form-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .danger {
      background-color: #c1121f !important;
    }
    .danger:hover {
      background-color: #a10f1a !important;
    }
  </style>
</head>
<body>
  <header class="admin-header">
    <div class="wrap">
      <h1>Painel Administrativo</h1>
      <nav class="admin-nav">
        <a href="#produtos">Produtos</a>
        <a href="#pedidos">Pedidos</a>
        <a href="#usuarios">UsuÃ¡rios</a>
        <a href="/">Voltar ao Site</a>
      </nav>
    </div>
  </header>

  <main class="admin-main wrap">

    <!-- SeÃ§Ã£o de Boas-vindas -->
    <section id="inicio" class="card destaque">
      <h2>Bem-vindo ao Painel Administrativo ðŸ‘‹</h2>
      <p>Gerencie os produtos, pedidos e usuÃ¡rios de forma prÃ¡tica e centralizada.</p>
      <div class="tiles">
        <div class="tile">
          <span>Produtos Cadastrados</span>
          <strong id="produtosCount">{{ produtos|length }}</strong>
        </div>
        <div class="tile">
          <span>Total de Pedidos</span>
          <strong>{{ pedidos|length }}</strong>
        </div>
        <div class="tile">
          <span>UsuÃ¡rios Cadastrados</span>
          <strong>{{ clientes|length }}</strong>
        </div>
      </div>
    </section>

    <!-- SeÃ§Ã£o de Produtos -->
    <section id="produtos" class="card">
      <h2>ðŸ“¦ Gerenciar Produtos</h2>
      
      <!-- FormulÃ¡rio para Novo Produto -->
      <div class="form-section">
        <h3>âž• Adicionar Novo Produto</h3>
        <form action="/admin/produto" method="POST" enctype="multipart/form-data">
          <div class="form-group">
            <input type="text" name="nome" placeholder="Nome do produto" required>
            <textarea name="descricao" placeholder="DescriÃ§Ã£o do produto"></textarea>
            <input type="number" name="preco" placeholder="PreÃ§o" step="0.01" required>
            <select name="tamanho" required>
              <option value="">Selecione o tamanho</option>
              <option value="PP">PP</option>
              <option value="P">P</option>
              <option value="M">M</option>
              <option value="G">G</option>
              <option value="GG">GG</option>
              <option value="XG">XG</option>
            </select>
            <textarea name="cor" placeholder="DescriÃ§Ã£o de cor"></textarea>
            <input type="file" name="imagem" accept="img/*">
            <input type="file" name="imagem1" accept="img/*">
            <input type="file" name="imagem2" accept="img/*">
            <input type="file" name="imagem3" accept="img/*">
            <input type="number" name="estoque" placeholder="Quantidade em estoque" required>
          </div>
          <button type="submit" class="btn">Cadastrar Produto</button>
        </form>
      </div>

      <!-- Tabela de Produtos -->
      <div class="table-section">
        <h3>Lista de Produtos</h3>
        <input type="text" class="busca" id="buscaProdutos" placeholder="Buscar produtos...">
        <table class="tabela">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>PreÃ§o</th>
              <th>Estoque</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            {% if produtos %}
              {% for p in produtos %}
              <tr>
                <td>{{ p.id_produto }}</td>
                <td>{{ p.nome }}</td>
                <td>R$ {{ "%.2f"|format(p.preco) }}</td>
                <td>{{ p.estoque if p.estoque is not none else '-' }}</td>
                <td>
                  <form action="/admin/produto/{{ p.id_produto }}/delete" method="POST" style="display:inline;" onsubmit="return confirmarExclusao({{ p.id_produto }})">
                    <button type="submit" class="btn small danger">Excluir</button>
                  </form>
                  <a href="/admin/produto/{{ p.id_produto }}/editar" class="btn small">Editar</a>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="5">Nenhum produto cadastrado.</td></tr>
            {% endif %}
          </tbody>
        </table>
    </section>

    <!-- SeÃ§Ã£o de Pedidos -->
    <section id="pedidos" class="card">
      <h2>ðŸ“‹ Gerenciar Pedidos</h2>
      {% if pedidos %}
      <table class="tabela">
        <thead>
          <tr>
            <th>ID Pedido</th>
            <th>Cliente</th>
            <th>Total</th>
            <th>Data</th>
            <th>Status</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>

      </table>
      {% else %}
      <p>Nenhum pedido encontrado.</p>
      {% endif %}
    </section>

    <!-- SeÃ§Ã£o de UsuÃ¡rios -->
    <section id="usuarios" class="card">
      <h2>ï¿½ Gerenciar UsuÃ¡rios</h2>
      {% if clientes %}
      <table class="tabela">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Email</th>
            <th>Tipo</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          {% for cliente in clientes %}
          <tr>
            <td>{{ cliente.id_cliente }}</td>
            <td>{{ cliente.nome }}</td>
            <td>{{ cliente.email }}</td>
            <td>{{ 'Admin' if cliente.is_admin else 'Cliente' }}</td>
            <td>
              <button class="btn small">Editar</button>
              <button class="btn small danger">Desativar</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>Nenhum usuÃ¡rio encontrado.</p>
      {% endif %}
    </section>

    <!-- SeÃ§Ã£o de GrÃ¡ficos -->
    <section id="graficos" class="card graficos">
      <h2>ðŸ“Š Resumo de Vendas</h2>
      <img src="#" alt="GrÃ¡fico ilustrativo">
    </section>

  </main>

  <script>
    // Busca de produtos
    document.getElementById('buscaProdutos')?.addEventListener('input', function(e) {
      const termo = e.target.value.toLowerCase();
      const linhas = document.querySelectorAll('.tabela tbody tr');
      
      linhas.forEach(linha => {
        const texto = linha.textContent.toLowerCase();
        linha.style.display = texto.includes(termo) ? '' : 'none';
      });
    });

    // ConfirmaÃ§Ãµes
    function confirmarExclusao(id) {
      return confirm('Tem certeza que deseja excluir este produto?');
    }

    function confirmarDesativacao(id) {
      return confirm('Tem certeza que deseja desativar este usuÃ¡rio?');
    }

    // AtualizaÃ§Ã£o automÃ¡tica dos tiles
    document.addEventListener('DOMContentLoaded', function() {
      const produtosCount = document.querySelectorAll('.tabela tbody tr').length;
      const countElement = document.querySelector('.tile strong');
      if (countElement) {
        countElement.textContent = produtosCount;
      }
    });
  </script>
</body>
</html>
